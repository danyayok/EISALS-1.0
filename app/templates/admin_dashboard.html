<!-- templates/admin_dashboard.html -->
{% extends "admin_base.html" %}

{% block title %}–î–∞—à–±–æ—Ä–¥ - –ê–¥–º–∏–Ω–∫–∞ EISALS{% endblock %}
{% block page_title %}–î–∞—à–±–æ—Ä–¥{% endblock %}

{% block admin_content %}
<div class="dashboard-grid">
    <!-- –ö–∞—Ä—Ç–æ—á–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ -->
    <div class="stat-card">
        <div class="stat-icon">üë•</div>
        <div class="stat-info">
            <h3>{{ total_users }}</h3>
            <p>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</p>
        </div>
    </div>

    <div class="stat-card">
        <div class="stat-icon">üìù</div>
        <div class="stat-info">
            <h3>{{ total_posts }}</h3>
            <p>–ü–æ—Å—Ç–æ–≤</p>
        </div>
    </div>

    <div class="stat-card">
        <div class="stat-icon">üí¨</div>
        <div class="stat-info">
            <h3>{{ total_comments }}</h3>
            <p>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤</p>
        </div>
    </div>

    <div class="stat-card">
        <div class="stat-icon">‚≠ê</div>
        <div class="stat-info">
            <h3>{{ (total_posts / total_users * 100)|round(1) if total_users > 0 else 0 }}%</h3>
            <p>–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</p>
        </div>
    </div>

    <!-- –ü–æ—Å–ª–µ–¥–Ω–∏–µ –ø–æ—Å—Ç—ã -->
    <div class="dashboard-section">
        <h2>–ü–æ—Å–ª–µ–¥–Ω–∏–µ –ø–æ—Å—Ç—ã</h2>
        <div class="recent-list">
            {% for post in recent_posts %}
            <div class="recent-item">
                <img src="{{ url_for('static', filename='users/graphs/' ~ post['img_path']) }}"
                     alt="–ì—Ä–∞—Ñ–∏–∫" class="post-thumb">
                <div class="recent-info">
                    <h4>{{ post['title'][:50] }}{% if post['title']|length > 50 %}...{% endif %}</h4>
                    <p>‚≠ê {{ post['rating'] }} | üí¨ {{ post['comms']|length }}</p>
                    <small>{{ post['created_at'][:10] }}</small>
                </div>
                <div class="recent-actions">
                    <a href="/graphs#post-{{ post['id'] }}" class="btn-small" target="_blank">–ü—Ä–æ—Å–º–æ—Ç—Ä</a>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- –ü–æ—Å–ª–µ–¥–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ -->
    <div class="dashboard-section">
        <h2>–ù–æ–≤—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</h2>
        <div class="recent-list">
            {% for user_id, user in recent_users.items() %}
            <div class="recent-item">
                <img src="{{ url_for('static', filename='users/avas/' ~ user['img_path']) }}"
                     alt="–ê–≤–∞—Ç–∞—Ä" class="user-avatar">
                <div class="recent-info">
                    <h4>{{ user['name'] }}</h4>
                    <p>üìß {{ user['email'] }}</p>
                    <small>–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω: {{ user['created_at'][:10] }}</small>
                </div>
                <div class="recent-actions">
                    <span class="badge {% if user.get('role') == 'admin' %}badge-admin{% else %}badge-user{% endif %}">
                        {{ user.get('role', 'user') }}
                    </span>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</div>
{% endblock %}